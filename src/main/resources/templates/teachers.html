<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>Ù…Ø¯Ø±Ø³ØªÙŠ Ø§Ù„Ø°ÙƒÙŠØ© - Ø§Ù„Ù…Ø¹Ù„Ù…ÙˆÙ†</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
    <style>
        body {
            margin: 0;
            font-family: 'Times New Roman', Times, serif;
            background-color: #f9f9f9;
            color: #222;
            height: 100vh;
            display: flex;
        }
        nav.sidebar {
            width: 240px;
            background-color: #1c1c1c;
            color: #f5f5f5;
            padding: 25px 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            font-weight: 600;
            letter-spacing: 0.03em;
            user-select: none;
        }
        nav.sidebar h2 {
            margin: 0 0 40px;
            font-size: 1.7rem;
            font-weight: 700;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
        }
        nav.sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
            flex-grow: 1;
        }
        nav.sidebar ul li a {
            display: block;
            padding: 12px 15px;
            color: #ddd;
            text-decoration: none;
            border-radius: 4px;
            transition: background-color 0.25s ease;
            font-size: 1.1rem;
        }
        nav.sidebar ul li a.active,
        nav.sidebar ul li a:hover {
            background-color: #444;
            color: #fff;
        }
        main.content {
            flex-grow: 1;
            background-color: white;
            margin: 20px;
            border-radius: 6px;
            padding: 40px 30px;
            box-sizing: border-box;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            color: #111;
            overflow-x: auto;
        }
        main.content h1 {
            font-family: 'Georgia', serif;
            font-size: 2.8rem;
            margin-bottom: 1.8rem;
            font-weight: 700;
            letter-spacing: 0.02em;
            text-align: center;
        }
        button {
            font-family: 'Times New Roman', Times, serif;
            font-weight: 600;
            cursor: pointer;
            border: none;
            border-radius: 3px;
            padding: 6px 12px;
            margin: 0 5px;
            transition: background-color 0.3s ease;
            font-size: 1rem;
        }
        .btn-add {
            background-color: #2c3e50;
            color: #f9f9f9;
            padding: 10px 20px;
            margin-bottom: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            border-radius: 5px;
            width: max-content;
        }
        .btn-add:hover {
            background-color: #1a242f;
        }
        .btn-view {
            background-color: #34495e;
            color: #f9f9f9;
        }
        .btn-view:hover {
            background-color: #2a3a4a;
        }
        .btn-edit {
            background-color: #b7950b;
            color: #1c1c1c;
        }
        .btn-edit:hover {
            background-color: #96790a;
        }
        .btn-delete {
            background-color: #7b241c;
            color: #f9f9f9;
        }
        .btn-delete:hover {
            background-color: #5c1a16;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 1.1rem;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px 8px;
            text-align: center;
            vertical-align: middle;
        }
        th {
            background-color: #ddd;
            color: #222;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <nav class="sidebar">
        <h2>Ù…Ø¯Ø±Ø³ØªÙŠ Ø§Ù„Ø°ÙƒÙŠØ©</h2>
        <ul>
            <li><a th:href="@{/dashboard}">ğŸ  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a></li>
            <li><a th:href="@{/teachers}" class="active">ğŸ‘¨â€ğŸ« Ø§Ù„Ù…Ø¹Ù„Ù…ÙˆÙ†</a></li>
                    <li><a th:href="@{/print}">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</a></li>

        </ul>
    </nav>

<main class="content">
    <h1>Ø§Ù„Ù…Ø¹Ù„Ù…ÙˆÙ†</h1>
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <button id="addTeacherBtn" class="btn-add">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„Ù… Ø¬Ø¯ÙŠØ¯</button>
        <button id="deleteSelectedBtn" class="btn-delete" style="display:none;">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ†</button>
    </div>

    <table>
        <thead>
            <tr>
                <th><input type="checkbox" id="selectAll" /></th> <!-- âœ… new column -->
                <th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„</th>
                <th>Ø§Ù„Ù„Ù‚Ø¨ Ø§Ù„Ø£ØµÙ„ÙŠ</th>
                <th>Ø§Ù„Ù„Ù‚Ø¨</th>
                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
        </thead>
        <tbody id="teachersTableBody">
            <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ø³ØªÙØ¶Ø§Ù Ù‡Ù†Ø§ -->
        </tbody>
    </table>
</main>

<script>
    async function fetchTeachers() {
        try {
            const response = await fetch('/api/teachers');
            if (!response.ok) throw new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†');
            const teachers = await response.json();
            const tbody = document.getElementById('teachersTableBody');
            tbody.innerHTML = '';

            teachers.forEach(teacher => {
                const tr = document.createElement('tr');

                // âœ… Checkbox column
                const tdCheckbox = document.createElement('td');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'rowCheckbox';
                checkbox.value = teacher.id;
                tdCheckbox.appendChild(checkbox);
                tr.appendChild(tdCheckbox);

                // First name
                const tdFirstName = document.createElement('td');
                tdFirstName.textContent = teacher.firstName || '';
                tr.appendChild(tdFirstName);

                // Original last name
                const tdOriginalLastName = document.createElement('td');
                tdOriginalLastName.textContent = teacher.originalLastName || '';
                tr.appendChild(tdOriginalLastName);

                // Last name
                const tdLastName = document.createElement('td');
                tdLastName.textContent = teacher.lastName || '';
                tr.appendChild(tdLastName);

                // Actions
                const tdActions = document.createElement('td');

                const btnView = document.createElement('button');
                btnView.textContent = 'Ø¹Ø±Ø¶';
                btnView.className = 'btn-view';
                btnView.onclick = () => window.location.href = `/teachers/view/${teacher.id}`;
                tdActions.appendChild(btnView);

                const btnEdit = document.createElement('button');
                btnEdit.textContent = 'ØªØ¹Ø¯ÙŠÙ„';
                btnEdit.className = 'btn-edit';
                btnEdit.onclick = () => window.location.href = `/teachers/edit/${teacher.id}`;
                tdActions.appendChild(btnEdit);

                const btnDelete = document.createElement('button');
                btnDelete.textContent = 'Ø­Ø°Ù';
                btnDelete.className = 'btn-delete';
                btnDelete.onclick = async () => {
                    if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ù„Ù… "${teacher.firstName} ${teacher.lastName}"ØŸ`)) {
                        await fetch(`/api/teachers/${teacher.id}`, { method: 'DELETE' });
                        fetchTeachers();
                    }
                };
                tdActions.appendChild(btnDelete);

                tr.appendChild(tdActions);
                tbody.appendChild(tr);
            });

            setupCheckboxHandlers();
        } catch (error) {
            alert(error.message);
        }
    }

    function setupCheckboxHandlers() {
        const selectAll = document.getElementById('selectAll');
        const rowCheckboxes = document.querySelectorAll('.rowCheckbox');
        const deleteSelectedBtn = document.getElementById('deleteSelectedBtn');

        // Toggle all rows
        selectAll.onclick = () => {
            rowCheckboxes.forEach(cb => cb.checked = selectAll.checked);
            toggleDeleteButton();
        };

        // Individual row checkboxes
        rowCheckboxes.forEach(cb => cb.onchange = toggleDeleteButton);

        function toggleDeleteButton() {
            const anyChecked = Array.from(rowCheckboxes).some(cb => cb.checked);
            deleteSelectedBtn.style.display = anyChecked ? 'inline-block' : 'none';
        }
    }

    document.getElementById('addTeacherBtn').onclick = () => window.location.href = '/teachers/add';

    document.getElementById('deleteSelectedBtn').onclick = async () => {
        const checkedBoxes = document.querySelectorAll('.rowCheckbox:checked');
        const ids = Array.from(checkedBoxes).map(cb => cb.value);

        if (ids.length === 0) return;
        if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${ids.length} Ù…Ø¹Ù„Ù…(ÙŠÙ†)ØŸ`)) return;

        try {
            // âœ… backend bulk delete request
            await fetch('/api/teachers/bulk-delete', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(ids)
            });
            alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­');
            fetchTeachers();
        } catch (error) {
            alert('ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù');
        }
    };

    // Load teachers
    fetchTeachers();
</script>

</body>
</html>
